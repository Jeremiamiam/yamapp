---
phase: 12-refonte-page-client-v2
plan: 02
type: execute
wave: 2
depends_on:
  - 12-01
files_modified:
  - src/features/clients/components/ClientDetailV2.tsx
  - src/features/clients/components/sections/ClientSidebarSection.tsx
  - src/features/clients/components/sections/ProjectsListSection.tsx
  - src/features/clients/components/ClientDetail.tsx
autonomous: true
requirements:
  - CLV2-01
  - CLV2-07
  - CLV2-09

must_haves:
  truths:
    - "Page client affiche sidebar fixe a gauche avec contacts, liens, et documents client"
    - "Zone principale affiche la liste des projets du client"
    - "Retroplanning visible en footer full-width permanent"
    - "Breadcrumb affiche le niveau de navigation courant"
    - "Sidebar ne montre que les documents client (sans projectId)"
    - "ClientDetail.tsx redirige vers le nouveau layout V2"
  artifacts:
    - path: "src/features/clients/components/ClientDetailV2.tsx"
      provides: "Layout principal sidebar + main + footer"
      min_lines: 100
    - path: "src/features/clients/components/sections/ClientSidebarSection.tsx"
      provides: "Sidebar avec contacts, liens, documents client"
      min_lines: 50
    - path: "src/features/clients/components/sections/ProjectsListSection.tsx"
      provides: "Liste des projets cliquables"
      min_lines: 40
  key_links:
    - from: "src/features/clients/components/ClientDetailV2.tsx"
      to: "src/features/clients/components/sections/ClientSidebarSection.tsx"
      via: "import and render in aside"
      pattern: "ClientSidebarSection"
    - from: "src/features/clients/components/ClientDetailV2.tsx"
      to: "src/features/clients/components/sections/RetroplanningSection.tsx"
      via: "import and render in footer"
      pattern: "RetroplanningSection"
    - from: "src/features/clients/components/ClientDetailV2.tsx"
      to: "useAppStore"
      via: "client data from Zustand store"
      pattern: "useAppStore"
---

<objective>
Create the new ClientDetailV2 layout with sidebar client fixe + zone principale projets + footer retroplanning. Replace the current ClientDetail rendering.

Purpose: Core layout restructuration — transforms the 3-column grid into a sidebar + main + drawer architecture per user decisions.
Output: Working page layout with sidebar (contacts, liens, docs client), projects list, and retroplanning footer.
</objective>

<execution_context>
@/Users/jeremyhervo/.claude/get-shit-done/workflows/execute-plan.md
@/Users/jeremyhervo/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-refonte-page-client-v2-sidebar-client-fixe-drawer-projet-distinction-docs-client-projet-import-plaud-double-acc-s-retroplanning-footer/12-RESEARCH.md
@.planning/phases/12-refonte-page-client-v2-sidebar-client-fixe-drawer-projet-distinction-docs-client-projet-import-plaud-double-acc-s-retroplanning-footer/12-01-SUMMARY.md

@src/app/proto/client-detail-v2/page.tsx
@src/features/clients/components/ClientDetail.tsx
@src/features/clients/components/sections/RetroplanningSection.tsx
@src/features/clients/components/sections/DocumentsSection.tsx
@src/features/clients/components/sections/ContactsSection.tsx
@src/features/clients/components/sections/LinksSection.tsx
@src/types/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: ClientSidebarSection + ProjectsListSection components</name>
  <files>
    src/features/clients/components/sections/ClientSidebarSection.tsx
    src/features/clients/components/sections/ProjectsListSection.tsx
  </files>
  <action>
    **ClientSidebarSection.tsx** — Sidebar client fixe, 3 sections toujours ouvertes (per user decision: pas de collapse).

    Props: `{ client: Client }` (from store types).

    Structure:
    1. **Contacts** section header "Contacts" + list of `client.contacts`. Each contact: nom + role sur une ligne. Style compact comme le proto V2 (text-xs). Bouton + pour ajouter (ouvre la modale existante `contact-form` via `setActiveModal`).

    2. **Liens** section header "Liens" + list of `client.links`. Each link: titre cliquable (opens in new tab). Bouton + pour ajouter (ouvre la modale `link-form`).

    3. **Documents client** section header "Documents" + bouton Import PLAUD (ouvre `report-upload` modal avec `clientId` seulement, PAS de `projectId`). Filter documents: `client.documents.filter(d => !d.projectId)`. Affichage ultra-compact per user decision: titre + badge type coloré seulement. Badge colors: brief=cyan, report=amber, note=lime, creative-strategy=violet, web-brief=coral, social-brief=magenta. Use `var(--accent-*)` tokens.

    Style: `overflow-y-auto` pour scroll interne si contenu dépasse. Background `var(--bg-secondary)/30`.

    **ProjectsListSection.tsx** — Liste des projets dans la zone principale.

    Props: `{ client: Client, projects: Project[], onSelectProject: (projectId: string) => void, selectedProjectId: string | null }`.

    Structure:
    - Header "Projets" + bouton "+" pour ajouter un projet (ouvre la modale existante `project-form`)
    - Grille/liste de cards projet. Each card: nom projet, nombre de produits (count of deliverables with matching projectId), badge statut (si facturation disponible via `computeProjectBilling`).
    - Card cliquable → appelle `onSelectProject(project.id)`
    - Si `selectedProjectId` correspond, card a un outline/border accent (visual feedback que le drawer est ouvert sur ce projet)
    - État vide: "Aucun projet — Créer un premier projet" avec CTA

    Importer `computeProjectBilling` depuis `src/lib/project-billing.ts` pour le badge statut facturation.

    Style: cards avec `bg-[var(--bg-card)]`, `border border-[var(--border-subtle)]`, `hover:border-[var(--accent-cyan)]/40`.
  </action>
  <verify>
    - `npx tsc --noEmit` passes
    - Both components exported correctly
    - ClientSidebarSection filters documents by `!d.projectId`
    - ProjectsListSection calls `onSelectProject` on click
  </verify>
  <done>
    ClientSidebarSection renders contacts + liens + docs client (filtered). ProjectsListSection renders clickable project cards with billing badge.
  </done>
</task>

<task type="auto">
  <name>Task 2: ClientDetailV2 layout (sidebar + main + footer) replacing ClientDetail</name>
  <files>
    src/features/clients/components/ClientDetailV2.tsx
    src/features/clients/components/ClientDetail.tsx
  </files>
  <action>
    **ClientDetailV2.tsx** — New main layout component. Follow the proto V2 structure exactly (per research Pattern 1).

    ```tsx
    // Structure cible (from proto, adapted to real data)
    <div className="min-h-screen flex flex-col bg-[var(--bg-primary)]">
      {/* Header: bouton retour + nom client + badge statut */}
      <header className="flex-shrink-0 flex items-center gap-3 px-4 py-3 border-b border-[var(--border-subtle)]">
        {/* Bouton retour vers ClientsList */}
        {/* Nom client + badge C/P */}
      </header>

      {/* Breadcrumb (toujours visible per user decision) */}
      <nav className="flex-shrink-0 px-4 py-2 text-xs text-[var(--text-secondary)]">
        {/* Client > Projets > [Nom projet] */}
      </nav>

      {/* Corps: sidebar fixe + zone principale */}
      <div className="flex-1 flex min-h-0 overflow-hidden">
        {/* Sidebar client fixe */}
        <aside className="flex-shrink-0 w-72 xl:w-80 border-r border-[var(--border-subtle)] overflow-y-auto">
          <ClientSidebarSection client={client} />
        </aside>

        {/* Zone principale */}
        <main className="flex-1 min-w-0 flex flex-col overflow-hidden relative">
          {/* Liste projets (dimmée quand drawer ouvert via opacity) */}
          <div className={selectedProjectId ? 'opacity-30 pointer-events-none' : ''}>
            <ProjectsListSection
              client={client}
              projects={clientProjects}
              onSelectProject={setSelectedProjectId}
              selectedProjectId={selectedProjectId}
            />
          </div>

          {/* Placeholder for ProjectDrawer (Plan 03 will add it here) */}
          {/* {selectedProjectId && <ProjectDrawer ... />} */}
        </main>
      </div>

      {/* Footer retroplanning full-width (per user decision: pas dans sidebar) */}
      <footer className="flex-shrink-0 border-t border-[var(--border-subtle)] bg-[var(--bg-secondary)]/30">
        <RetroplanningSection clientId={client.id} />
      </footer>
    </div>
    ```

    State:
    - `selectedProjectId: string | null` — useState, drives drawer open/close (Plan 03 adds actual drawer)
    - Get client from `useAppStore` via `getSelectedClient()` or equivalent
    - Get projects from `useAppStore` via `getProjectsByClientId(client.id)` or filter from `state.projects`

    Breadcrumb: Simple text breadcrumb showing navigation level. When no project selected: "Client > Projets". When project selected: "Client > Projets > {project.name}".

    **ClientDetail.tsx** — Modify to render `ClientDetailV2` instead of the old layout. Keep the old component file for safety but replace its render with `<ClientDetailV2 />`. This way the navigation routing remains unchanged but the layout is the new V2.

    If ClientDetail receives clientId as prop, pass it through. If it reads from store, ClientDetailV2 does the same.
  </action>
  <verify>
    - `npx tsc --noEmit` passes
    - `npm run build` succeeds (or at minimum `next lint` passes)
    - ClientDetailV2 renders with sidebar on left, main area on right, footer at bottom
    - Breadcrumb updates based on selectedProjectId
    - RetroplanningSection renders in footer
  </verify>
  <done>
    Page client displays sidebar fixe (contacts, liens, docs client) on left, projects list in main area, retroplanning in full-width footer. Breadcrumb shows navigation level. Old ClientDetail delegates to ClientDetailV2.
  </done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` — no type errors
- Page renders with the 3-zone layout: sidebar | main | footer
- Sidebar shows contacts, liens, and only client documents (not project docs)
- Projects list shows project cards with billing badge
- Retroplanning visible in footer
- Breadcrumb visible and updates on project selection
</verification>

<success_criteria>
The client page has the new sidebar + main + footer layout. Sidebar displays contacts, liens, and client documents (filtered by !projectId). Main area shows projects list. Footer shows retroplanning. The old ClientDetail delegates to the new V2 component seamlessly.
</success_criteria>

<output>
After completion, create `.planning/phases/12-refonte-page-client-v2-sidebar-client-fixe-drawer-projet-distinction-docs-client-projet-import-plaud-double-acc-s-retroplanning-footer/12-02-SUMMARY.md`
</output>

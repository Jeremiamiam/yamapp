---
phase: 11-refonte-page-client
plan: 03
type: execute
wave: 2
depends_on: ["11-01", "11-02"]
files_modified:
  - src/features/clients/components/ClientDetail.tsx
  - src/features/clients/components/ProjectDrawer.tsx
  - src/features/clients/components/sections/ProjectsSection.tsx
  - src/features/clients/components/sections/DeliverablesSection.tsx
  - src/lib/store/store.ts
autonomous: true
requirements: []

must_haves:
  truths:
    - "Clic sur un projet ouvre un ProjectDrawer (sous-fenêtre / slide-in), pas une modale"
    - "ProjectDrawer reste dans la fenêtre (panel ou drawer depuis la droite)"
    - "ProjectDrawer affiche : infos projet, produits (deliverables), documents du projet"
    - "Fermeture par bouton ou Escape"
  artifacts:
    - path: "src/features/clients/components/ProjectDrawer.tsx"
      provides: "Drawer panel pour détail projet avec produits et documents"
  key_links:
    - from: "ProjectsSection"
      to: "ProjectDrawer"
      via: "onProjectSelect"
    - from: "DeliverablesSection"
      to: "ProjectDrawer"
      via: "onProjectSelect"
---

<objective>
Remplacer l'ouverture modale du projet par un ProjectDrawer — panel/drawer qui glisse depuis la droite (ou s'affiche en sous-fenêtre), reste dans la page client, affiche les produits et documents rattachés au projet.
</objective>

<execution_context>
@.planning/PROJECT.md
@planning/ROADMAP.md
@planning/STATE.md
@docs/CREATIVE-PIPELINE.md
</execution_context>

<context>
# Actuel
- openProjectModal(undefined, project) ouvre une ProjectModal (modale overlay)
- ProjectModal : édition projet, facturation, etc.

# Cible
- Clic projet → ouvrir ProjectDrawer (pas modale)
- ProjectDrawer : lecture/détail + produits + documents projet
- ProjectModal reste pour create/edit projet (CRUD)

# Store
- Ajouter selectedProjectId: string | null dans le store (ou state local ClientDetail)
- ProjectDrawer ouvert si selectedProjectId !== null
</context>

<tasks>

<task type="auto">
  <name>Task 1: Créer ProjectDrawer composant</name>
  <files>
    src/features/clients/components/ProjectDrawer.tsx
  </files>
  <action>
Créer `ProjectDrawer.tsx` :

Props: `{ project: Project; clientId: string; onClose: () => void }`

Layout:
- Panel slide-in depuis la droite (w-full sm:w-[420px] lg:w-[480px] max-w-[95vw])
- Fixed ou absolute position, z-50, bg-[var(--bg-primary)], border-l
- Header: nom projet, bouton fermer (X), bouton "Modifier" (ouvre ProjectModal edit)
- Corps scrollable:
  1. Section Produits : liste des deliverables avec projectId === project.id (ProductRow ou équivalent)
  2. Section Documents : liste des documents avec projectId === project.id
  3. Bouton "Importer Plaud" (prévu plan 11-04, placeholder pour l'instant)

Récupérer les données:
- Produits: `getDeliverablesByProjectId(project.id)` (existe déjà)
- Documents: `client.documents.filter(d => d.projectId === project.id)`

Design: cohérent avec les autres sections (rounded-xl border), typo dyslexia-friendly.
  </action>
  <verify>
ProjectDrawer affiche projet, produits, documents. Fermeture fonctionne.
  </verify>
  <done>
Composant ProjectDrawer créé et fonctionnel.
  </done>
</task>

<task type="auto">
  <name>Task 2: Store selectedProjectId + intégration ClientDetail</name>
  <files>
    src/lib/store/store.ts
    src/features/clients/components/ClientDetail.tsx
  </files>
  <action>
**Store** (ui.slice ou navigation.slice):
- Ajouter `selectedProjectId: string | null` 
- Actions: `openProjectDrawer(projectId: string)`, `closeProjectDrawer()` → set selectedProjectId

**ClientDetail**:
- Lire selectedProjectId depuis le store
- Si selectedProjectId: récupérer project via getProjectById ou projects.find
- Render: `{selectedProject && <ProjectDrawer project={selectedProject} clientId={client.id} onClose={closeProjectDrawer} />}`

Positionnement: ProjectDrawer en overlay sur la zone main (position fixed right), pas de navigation sortante.
  </action>
  <verify>
Ouverture fermeture drawer via store. Drawer s'affiche correctement.
  </verify>
  <done>
Store et ClientDetail intègrent ProjectDrawer.
  </done>
</task>

<task type="auto">
  <name>Task 3: Remplacer openProjectModal par openProjectDrawer au clic</name>
  <files>
    src/features/clients/components/sections/ProjectsSection.tsx
    src/features/clients/components/sections/DeliverablesSection.tsx
  </files>
  <action>
**ProjectsSection**:
- Au lieu de `onClick={() => openProjectModal(undefined, project)}`, utiliser `onClick={() => openProjectDrawer(project.id)}` (nouvelle action store)
- Garder le bouton "Ajouter un projet" qui ouvre openProjectModal(clientId) — create reste en modal

**DeliverablesSection**:
- Au clic sur le header du groupe projet (Folder + nom): `openProjectDrawer(group.projectId)` au lieu de `openProjectModal(undefined, project)`
- Même logique: create projet = modal, view projet = drawer

**useModal / hooks**:
- Ajouter openProjectDrawer dans useModal ou directement depuis le store
  </action>
  <verify>
Clic projet dans ProjectsSection ou DeliverablesSection → ouvre drawer, pas modale.
Ajouter projet → reste modale.
  </verify>
  <done>
Clic projet ouvre ProjectDrawer.
  </done>
</task>

<task type="auto">
  <name>Task 4: ProjectDrawer — CRUD produits et documents</name>
  <files>
    src/features/clients/components/ProjectDrawer.tsx
  </files>
  <action>
Dans ProjectDrawer:
- Section Produits: bouton "Ajouter produit" → openDeliverableModal(clientId, undefined) avec preset projectId dans le formulaire (DeliverableForm doit accepter presetProjectId)
- Liste produits: ProductRow existant ou simplifié, avec edit/delete
- Section Documents: bouton "Ajouter document" → ouvrir DocumentModal en mode create avec clientId + projectId preset
- Liste documents: liens cliquables pour ouvrir DocumentModal en mode view/edit

Vérifier que DeliverableForm et DocumentModal/create supportent projectId. Si addDocument(clientId, { ..., projectId }) existe (plan 11-01), l'utiliser.
  </action>
  <verify>
On peut ajouter un produit et un document dans le ProjectDrawer, rattachés au projet.
  </verify>
  <done>
CRUD produits et documents dans le drawer.
  </done>
</task>

</tasks>

<verification>
1. ProjectDrawer s'ouvre au clic projet
2. Affiche produits et documents du projet
3. On peut ajouter produit/document avec projectId
4. Fermeture par bouton ou Escape
5. Modifier projet (edit) ouvre ProjectModal
6. npx tsc --noEmit pass
</verification>

<success_criteria>
- Clic projet → drawer, pas modale
- Drawer affiche produits + documents projet
- CRUD inline dans le drawer
- Expérience fluide, reste dans la fenêtre
</success_criteria>

<output>
After completion, create planning/phases/11-.../11-03-SUMMARY.md
</output>

---
phase: 11-refonte-page-client
plan: 04
type: execute
wave: 2
depends_on: ["11-01", "11-03"]
files_modified:
  - src/features/clients/components/ProjectDrawer.tsx
  - src/features/clients/components/DocumentModal.tsx
  - docs/CREATIVE-PIPELINE.md
autonomous: true
requirements: []

must_haves:
  truths:
    - "Dans le ProjectDrawer, bouton 'Importer Plaud' déclenche le flow complet"
    - "Flow: upload/paste transcription → analyze-plaud → Report doc créé avec project_id"
    - "Offre suggérée: suggestedDeliverables/suggestedEvents → ajout au projet"
    - "Bouton 'Brief créatif →' sur le Report pour lancer brief-from-plaud (process pipeline)"
  artifacts:
    - path: "src/features/clients/components/ProjectDrawer.tsx"
      provides: "Import Plaud flow intégré"
  key_links:
    - from: "ProjectDrawer"
      to: "/api/analyze-plaud"
      via: "Import Plaud"
    - from: "ProjectDrawer"
      to: "/api/brief-from-plaud"
      via: "Brief créatif"
    - from: "docs/CREATIVE-PIPELINE.md"
      to: "process"
      via: "Plaud → Report → Brief → Board → Web"
---

<objective>
Intégrer l'import Plaud dans le projet : bouton dans ProjectDrawer qui déclenche le flow complet (transcription → analyze-plaud → Report doc rattaché au projet → optionnel suggested deliverables/events → Brief créatif → pipeline créatif).
</objective>

<execution_context>
@.planning/PROJECT.md
@planning/ROADMAP.md
@planning/STATE.md
@docs/CREATIVE-PIPELINE.md
</execution_context>

<context>
# Pipeline Plaud (CREATIVE-PIPELINE.md)
1. Plaud transcription → POST /api/analyze-plaud → ReportPlaudTemplate
2. Report.rawTranscript → POST /api/brief-from-plaud → Brief texte
3. Brief → Creative Board → Synthèse
4. Synthèse → Web architect → Homepage

# Point d'entrée actuel
- ReportUploadModal, DocumentForm (mode Report Plaud) — côté client
- addDocument avec content = Report JSON + rawTranscript

# Cible
- ProjectDrawer : bouton "Importer Plaud"
- Ouvre modal/flow : textarea ou upload pour coller transcription
- Submit → analyze-plaud API → créer document type report avec project_id
- Afficher suggestedDeliverables/suggestedEvents, proposer d'ajouter au projet
- Sur le Report créé : bouton "Brief créatif →" (existant dans DocumentModal) pour brief-from-plaud
</context>

<tasks>

<task type="auto">
  <name>Task 1: Bouton Importer Plaud dans ProjectDrawer</name>
  <files>
    src/features/clients/components/ProjectDrawer.tsx
  </files>
  <action>
Dans la section Documents du ProjectDrawer :
- Ajouter un bouton "Importer Plaud" (ou "+ Plaud") bien visible
- Au clic : ouvrir un modal ou inline step pour saisir/coller la transcription

Options :
A) Réutiliser ReportUploadModal existant en lui passant clientId + projectId
B) Créer ProjectPlaudImportModal spécifique

Recommandation A si ReportUploadModal peut accepter projectId. Sinon B.

Flow:
1. User clique "Importer Plaud"
2. Modal avec textarea (colle transcription) ou zone drag-drop fichier .txt
3. User valide → appel POST /api/analyze-plaud avec transcript
4. Réponse ReportPlaudTemplate → créer document avec addDocument(clientId, { type: 'report', title: report.title, content: JSON.stringify({...report, rawTranscript: transcript}), projectId })
5. Fermer modal, refresh drawer (nouveau doc dans la liste)
6. Optionnel: si report.suggestedDeliverables ou suggestedEvents, afficher une étape "Ajouter ces éléments au projet ?" avec checkboxes, puis créer deliverables/calls
  </action>
  <verify>
Import Plaud crée un document report rattaché au projet.
  </verify>
  <done>
Bouton et flow Importer Plaud fonctionnels.
  </done>
</task>

<task type="auto">
  <name>Task 2: Suggested deliverables/events → ajout au projet</name>
  <files>
    src/features/clients/components/ProjectDrawer.tsx
  </files>
  <action>
Après analyse Plaud, si le Report contient suggestedDeliverables ou suggestedEvents :
- Afficher une étape ou modal "Éléments suggérés"
- Liste des deliverables suggérés (name, type) avec checkbox
- Liste des events suggérés (type, label, date) avec checkbox
- Bouton "Ajouter au projet" : pour chaque coché, créer deliverable ou call avec clientId + projectId

Deliverables : addDeliverable avec projectId
Calls : addCall avec clientId (calls n'ont pas projectId ? vérifier schema) — si pas projectId sur calls, les créer au niveau client

Vérifier schema calls — si pas de project_id, les events suggérés restent client-level. Documenter.
  </action>
  <verify>
Suggested deliverables ajoutés au projet (projectId). Suggested events créés (client ou projet selon schema).
  </verify>
  <done>
Suggested items ajoutables au projet.
  </done>
</task>

<task type="auto">
  <name>Task 3: Accès Brief créatif et pipeline depuis Report projet</name>
  <files>
    src/features/clients/components/DocumentModal.tsx
  </files>
  <action>
Quand on ouvre un document Report (depuis ProjectDrawer) :
- DocumentModal affiche le Report avec les actions existantes
- Bouton "Brief créatif →" : utilise rawTranscript, appelle brief-from-plaud
- Le brief créé : doit-il être client-level ou project-level ?

Décision: Brief créé = project-level (projectId) car issu d'un Report du projet. Ainsi le brief reste dans le contexte projet.

Modifier le flow "Brief créatif →" dans DocumentModal :
- Si document.projectId existe, passer projectId au nouveau document brief
- addDocument(clientId, { type: 'brief', ..., projectId: document.projectId })

Même logique pour "Envoyer au Creative Board" : le brief prefill vient du projet.
  </action>
  <verify>
Brief créé depuis Report projet a projectId. Pipeline (Creative Board, Web) fonctionne.
  </verify>
  <done>
Pipeline complet depuis document projet.
  </done>
</task>

<task type="auto">
  <name>Task 4: ReportUploadModal avec projectId</name>
  <files>
    src/features/clients/components/ReportUploadModal.tsx (ou équivalent)
  </files>
  <action>
Vérifier l'existant ReportUploadModal / flow report upload :
- S'il est utilisé pour l'import Plaud client-level, l'étendre pour accepter projectId optionnel
- addDocument doit recevoir projectId quand fourni

Ou : le ProjectDrawer utilise son propre mini-flow (textarea + fetch analyze-plaud + addDocument) sans réutiliser ReportUploadModal, pour rester simple.

Choisir l'option la plus simple : soit étendre ReportUploadModal, soit flow inline dans ProjectDrawer.
  </action>
  <verify>
Import Plaud depuis ProjectDrawer crée doc avec project_id.
  </verify>
  <done>
Flow cohérent avec projectId.
  </done>
</task>

</tasks>

<verification>
1. Importer Plaud dans ProjectDrawer crée Report avec project_id
2. Suggested deliverables/events proposés et ajoutables
3. Brief créatif depuis Report projet a projectId
4. Pipeline créatif (Board, Web) accessible depuis documents projet
5. npx tsc --noEmit pass
</verification>

<success_criteria>
- Import Plaud fonctionnel dans le projet
- Process complet (Report → Brief → Board → Web) disponible depuis le contexte projet
- Documentation à jour si nécessaire
</success_criteria>

<output>
After completion, create planning/phases/11-.../11-04-SUMMARY.md
</output>

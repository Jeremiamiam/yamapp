---
phase: 11-refonte-page-client
plan: 02
type: execute
wave: 1
depends_on: ["11-00"]
files_modified:
  - src/features/clients/components/ClientDetail.tsx
  - src/features/clients/components/sections/ContactsSection.tsx
  - src/features/clients/components/sections/LinksSection.tsx
  - src/features/clients/components/sections/DocumentsSection.tsx
  - src/features/clients/components/sections/RetroplanningSection.tsx
autonomous: true
requirements: []

must_haves:
  truths:
    - "Page client utilise une vraie sidebar fixe à gauche (contacts, liens, documents client, retro planning)"
    - "Sidebar prend ~280-320px de largeur, scroll interne si besoin"
    - "Zone principale à droite prend le reste de l'espace (projets + produits)"
    - "Plus d'espace exploité — retirer max-w-5xl ou l'adapter"
  artifacts:
    - path: "src/features/clients/components/ClientDetail.tsx"
      provides: "Layout sidebar + main avec plus d'espace"
  key_links:
    - from: "ClientDetail"
      to: "sections"
      via: "sidebar fixe"
      pattern: "flex"
---

<objective>
Migrer le layout validé de la page proto (11-00) vers ClientDetail réel. Sidebar fixe à gauche (contacts, liens, documents client, retro), zone principale à droite (projets + produits). Utiliser les vraies données et composants existants.
</objective>

<execution_context>
@.planning/PROJECT.md
@planning/ROADMAP.md
@planning/STATE.md
</execution_context>

<context>
# Prerequisite
- Plan 11-00 : page proto /proto/client-detail-v2 avec layout cible validé

# Current layout (ClientDetail.tsx)
- Grid lg:grid-cols-3 : gauche 1 col (ContactsSection, LinksSection, DocumentsSection), droite 2 cols (DeliverablesSection)
- RetroplanningSection full width below
- max-w-5xl mx-auto sur le contenu scrollable

# Desired layout (aligné sur proto validé)
- Flex row: sidebar fixe (w-72 ou w-80) + main flex-1
- Sidebar: scroll overflow-y-auto, bg distinct — ContactsSection, LinksSection, DocumentsSection (client only), RetroplanningSection
- Main: ProjectsSection + DeliverablesSection
- Retro planning dans la sidebar
</context>

<tasks>

<task type="auto">
  <name>Task 1: Refonte layout ClientDetail — sidebar + main</name>
  <files>
    src/features/clients/components/ClientDetail.tsx
  </files>
  <action>
Remplacer la structure actuelle par :

```tsx
{/* Barre contextuelle client - inchangée */}
<div className="flex-shrink-0 px-4 sm:px-6 py-4 border-b ...">
  ...
</div>

{/* Contenu: sidebar + main */}
<div className="flex-1 flex min-h-0 overflow-hidden">
  {/* Sidebar gauche fixe */}
  <aside className="flex-shrink-0 w-72 xl:w-80 border-r border-[var(--border-subtle)] bg-[var(--bg-secondary)]/30 overflow-y-auto overflow-x-hidden">
    <div className="p-4 space-y-6">
      <ContactsSection clientId={client.id} />
      <LinksSection clientId={client.id} />
      <DocumentsSection clientId={client.id} />
      <RetroplanningSection clientId={client.id} />
    </div>
  </aside>

  {/* Zone principale — projets + produits */}
  <main className="flex-1 min-w-0 overflow-y-auto p-4 sm:p-6">
    <div className="max-w-6xl">
      <ProjectsSection clientId={client.id} />
      <DeliverablesSection clientId={client.id} />
    </div>
  </main>
</div>
```

- Importer ProjectsSection (actuellement pas dans ClientDetail)
- RetroplanningSection passe dans la sidebar (au lieu de full width below)
- DeliverablesSection et ProjectsSection dans la zone principale
- Supprimer max-w-5xl, utiliser max-w-6xl ou rien pour plus d'espace
  </action>
  <verify>
Layout responsive: sur mobile (< lg), sidebar peut devenir collapse ou stack vertical selon contraintes accessibilité.
  </verify>
  <done>
Sidebar fixe avec 4 sections. Main avec projets + produits.
  </done>
</task>

<task type="auto">
  <name>Task 2: Sidebar responsive (mobile)</name>
  <files>
    src/features/clients/components/ClientDetail.tsx
  </files>
  <action>
Sur écrans &lt; lg (1024px) :
- Option A: Sidebar en haut, main en bas (stack vertical) — simple
- Option B: Sidebar collapsible avec bouton toggle

Recommandation: Option A pour Phase 11 — stack vertical sur mobile. La sidebar devient une section scrollable en haut, puis main en dessous. Même ordre: contacts, liens, documents, retro, puis projets+produits.

Structure conditionnelle:
- lg:flex pour row
- Default: flex-col, sidebar en premier
  </action>
  <verify>
Sur viewport &lt; 1024px, le contenu est lisible et accessible.
  </verify>
  <done>
Mobile: stack vertical, ordre préservé.
  </done>
</task>

<task type="auto">
  <name>Task 3: Ajuster les sections pour la sidebar</name>
  <files>
    src/features/clients/components/sections/ContactsSection.tsx
    src/features/clients/components/sections/LinksSection.tsx
    src/features/clients/components/sections/DocumentsSection.tsx
    src/features/clients/components/sections/RetroplanningSection.tsx
  </files>
  <action>
Les sections restent globalement inchangées. Ajustements mineurs si besoin :
- Réduire padding interne si la sidebar est plus étroite
- RetroplanningSection : peut être plus compact en hauteur (Gantt réduit ou scroll interne) pour tenir dans la sidebar
- Si le Gantt retro est trop grand pour la sidebar, considérer un mode "compact" avec bouton "Voir en grand" qui ouvre en modal/drawer

Décision: Laisser RetroplanningSection tel quel dans la sidebar. Si overflow, scroll interne. L'utilisateur a demandé "on peut laisser le retro planning à cet endroit" — donc in-sidebar.
  </action>
  <verify>
Sections s'affichent correctement dans la sidebar, pas de overflow horizontal.
  </verify>
  <done>
Sections adaptées à la sidebar.
  </done>
</task>

</tasks>

<verification>
1. Sidebar fixe gauche avec contacts, liens, documents, retro
2. Main zone avec ProjectsSection + DeliverablesSection
3. Layout responsive (stack vertical mobile)
4. Plus d'espace horizontal exploité
5. npx tsc --noEmit pass
</verification>

<success_criteria>
- Page client avec vraie sidebar
- Retro planning dans la sidebar
- Zone principale pour projets et produits
- Interface utilisable sur mobile
</success_criteria>

<output>
After completion, create planning/phases/11-.../11-02-SUMMARY.md
</output>
